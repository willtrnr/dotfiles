#! /usr/bin/env sh

if [ -z "$1" ] || [ "$UID" != "0" ]; then
  exit 1
fi

DST_CHROOT="$1"; shift

# Prepare the chroot
CHROOT_BINDS=(dev proc run sys etc/resolv.conf)

for m in ${CHROOT_BINDS[@]}; do
  mount -o bind /$m $DST_CHROOT/$m
done

# Enter the chroot
if [ -n "$1" ]; then
  chroot $DST_CHROOT "$@"
else
  chroot $DST_CHROOT bash --login
fi

# Cleanup the mounts
for m in ${CHROOT_BINDS[@]}; do
  umount $DST_CHROOT/$m
done
